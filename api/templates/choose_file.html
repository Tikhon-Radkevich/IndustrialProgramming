<!DOCTYPE html>
<html lang="en">
<body>
    <h1>Upload File</h1>

    <label for="useCustomLibs">Use Custom Libs</label>
    <input type="checkbox" id="useCustomLibs" name="customLibs" value="true">

    <form id="uploadForm" action="/uploadfile/" method="post" enctype="multipart/form-data">
        <label for="file">Choose file</label>
        <input type="file" name="file" id="file" accept=".json, .xml">

        <label for="fileOption">Choose file option:</label>
        <select id="fileOption">
            <option value="none">no option</option>
            <option value="unzip">Unzip</option>
            <option value="decrypt">Decrypt</option>
            <option value="unzip-decrypt">Unzip -> Decrypt</option>
            <option value="decrypt-unzip">Decrypt -> Unzip</option>
        </select>

        <label for="keyInput">Enter key:</label>
        <input type="text" id="keyInput" name="textInput">

        <input type="button" value="Confirm" onclick="uploadFile()">
    </form>

    <form id="downloadForm" action="/download/" method="post" enctype="multipart/form-data">
        <label for="fileName">Type File Name</label>
        <input type="text" id="fileName" name="textInput">

        <label for="fileFormat">Choose File Format:</label>
        <select id="fileFormat">
            <option value=".json">JSON</option>
            <option value=".xml">XML</option>
        </select>

        <label for="saveFileOption">Choose file option:</label>
        <select id="saveFileOption">
            <option value="none">no option</option>
            <option value="zip">ZIP</option>
            <option value="encrypt">Encrypt</option>
            <option value="zip-encrypt">ZIP -> Encrypt</option>
            <option value="encrypt-zip">Encrypt -> ZIP</option>
        </select>

        <input type="button" value="Confirm" onclick="downloadFile()">
    </form>

    <div id="messageDiv"></div>

    <script>
        async function uploadFile() {
            const fileOption = document.getElementById("fileOption").value;
            const fileInput = document.getElementById("file").files[0];
            const textInput = document.getElementById("keyInput").value;
            const useCustomLibsCheckbox = document.getElementById("useCustomLibs");
            const useCustomLibsValue = useCustomLibsCheckbox.checked;

            const formData = new FormData();
            formData.append("file_option", fileOption);
            formData.append("file", fileInput);
            formData.append("key", textInput);
            formData.append("use_custom_libs", useCustomLibsValue);

            const response = await fetch("/uploadfile/", {
                method: "POST",
                body: formData
            });
            const result = await response.json();

            console.log(result.message);

            document.getElementById("messageDiv").innerText = result.message;
            window.expressionsData = result.expressions_data;
        }

        async function downloadFile() {
            const fileOption = document.getElementById("saveFileOption").value;
            const fileFormat = document.getElementById("fileFormat").value;
            const fileName = document.getElementById("fileName").value;
            const useCustomLibsCheckbox = document.getElementById("useCustomLibs");
            const useCustomLibsValue = useCustomLibsCheckbox.checked;

            const formData = new FormData();
            formData.append("file_option", fileOption);
            formData.append("file_name", fileName);
            formData.append("file_format", fileFormat);
            formData.append("expressions_data",  JSON.stringify(window.expressionsData));
            formData.append("use_custom_libs", useCustomLibsValue);

            const response = await fetch("/download/", {
                method: "POST",
                body: formData
            });
            const result = await response.text();

            console.log(result.message);
        }
    </script>
</body>
</html>
